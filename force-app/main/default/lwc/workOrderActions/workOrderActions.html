<template>
  <div class="mobile-backdrop" onclick={closeModal}></div>

  <div class="mobile-bottom-sheet">
    <div class="bottom-sheet-header">
      <div class="drag-indicator"></div>
      <h2 class="sheet-title">{labels.WorkOrderActions_Header}</h2>
    </div>

    <div class="bottom-sheet-content">
      <!-- Initial Screen -->
      <template if:true={showInitialScreen}>
        <div class="action-buttons">
          <button class="action-button brand" onclick={logShopVisit}>
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:store"
                size="medium"
                class="slds-m-bottom_small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.WorkOrderActions_Shop_Visit_Header}</span
              >
              <span class="button-description"
                >{labels.WorkOrderActions_Shop_Visit_Description}</span
              >
            </span>
          </button>

          <button class="action-button brand" onclick={logSpecialEquipment}>
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:custom_apps"
                size="medium"
                class="slds-m-bottom_small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.WorkOrderActions_Special_Equipment_Header}</span
              >
              <span class="button-description"
                >{labels.WorkOrderActions_Special_Equipment_Description}</span
              >
            </span>
          </button>

          <button class="action-button brand" onclick={logEditTasks}>
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:edit"
                size="medium"
                class="slds-m-bottom_small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.WorkOrderActions_Edit_Tasks_Header}</span
              >
              <span class="button-description"
                >{labels.WorkOrderActions_Edit_Tasks_Description}</span
              >
            </span>
          </button>

          <!-- Add cancel button -->
          <div class="button-container">
            <button class="cancel-button" onclick={closeAction}>
              {labels.WorkOrderActions_Cancel_Button}
            </button>
          </div>
        </div>
      </template>

      <!-- Shop Visit Form -->
      <template if:true={showLogShopVisit}>
        <lightning-record-edit-form
          object-api-name="WorkOrder"
          record-id={recordId}
          onsubmit={handleSubmit}
          onsuccess={handleSuccess}
          class="form-container"
        >
          <div class="form-fields">
            <lightning-input-field field-name="Shop_Name__c" required>
            </lightning-input-field>
            <lightning-input-field field-name="Shop_Visit_Date__c" required>
            </lightning-input-field>
            <lightning-input-field
              field-name="Shop_Visit_Start_Time__c"
              required
            >
            </lightning-input-field>
            <lightning-input-field field-name="Shop_Visit_End_Time__c" required>
            </lightning-input-field>
            <lightning-input-field field-name="Collected_Items__c">
            </lightning-input-field>

            <c-image-capture-test
              record-id={recordId}
              object-api-name="WorkOrder"
            ></c-image-capture-test>
          </div>

          <div class="button-group sticky-buttons">
            <button class="cancel-button" type="button" onclick={closeModal}>
              {labels.WorkOrderActions_Cancel_Button}
            </button>
            <button class="submit-button" type="submit">
              {labels.WorkOrderActions_Save_Button}
            </button>
          </div>
        </lightning-record-edit-form>
      </template>

      <!-- Special Equipment Form -->
      <template if:true={showLogSpecialEquipment}>
        <lightning-record-edit-form
          object-api-name="WorkOrder"
          record-id={recordId}
          onsubmit={handleSubmit}
          onsuccess={handleSuccess}
        >
          <div class="form-fields">
            <lightning-input-field field-name="Special_Equipment__c" required>
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button class="cancel-button" type="button" onclick={closeModal}>
              {labels.WorkOrderActions_Cancel_Button}
            </button>
            <button class="submit-button" type="submit">
              {labels.WorkOrderActions_Save_Button}
            </button>
          </div>
        </lightning-record-edit-form>
      </template>

      <!-- Edit Tasks Form -->
      <template if:true={showLogEditTasks}>
        <lightning-record-edit-form
          object-api-name="WorkOrder"
          record-id={recordId}
          onsuccess={handleSuccess}
        >
          <div class="form-fields">
            <lightning-input-field
              field-name="WorkOrderNumber"
              disabled
              class="slds-hide"
            >
            </lightning-input-field>
            <lightning-input-field
              field-name="AccountId"
              disabled
              class="slds-hide"
            >
            </lightning-input-field>
            <lightning-input-field field-name="Goodwill_Tasks__c" required>
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button class="cancel-button" type="button" onclick={closeModal}>
              {labels.WorkOrderActions_Cancel_Button}
            </button>
            <button class="submit-button" type="submit">
              {labels.WorkOrderActions_Save_Button}
            </button>
          </div>
        </lightning-record-edit-form>
      </template>
    </div>
  </div>
</template>