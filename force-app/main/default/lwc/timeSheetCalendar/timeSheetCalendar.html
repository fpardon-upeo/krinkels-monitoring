<template>
  <div class="calendar-container">
    <template if:true={isLoading}>
      <lightning-spinner
        alternative-text="Loading"
        size="medium"
      ></lightning-spinner>
    </template>

    <!-- Combined Stats and Mileage Buttons Section -->
    <div class="top-section">
      <!-- Stats Container -->
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-iconAndInfo-container">
            <div class="stat-icon">
              <lightning-icon
                icon-name="utility:clock"
                size="small"
                class="work-icon"
              ></lightning-icon>
            </div>
            <div class="stat-info">
              <span class="stat-label">Work Hours</span>
              <span class="stat-value"
                >{workHours}h / {expectedWorkHours}h
              </span>
            </div>
          </div>
        </div>

        <!-- <div class="stat-card">
          <div class="stat-iconAndInfo-container">
            <div class="stat-icon">
              <lightning-icon
                icon-name="utility:travel_and_places"
                size="small"
                class="travel-icon"
              ></lightning-icon>
            </div>
            <div class="stat-info">
              <span class="stat-label">Travel Hours</span>
              <span class="stat-value">{travelHours}h</span>
            </div>
          </div>
        </div> -->

        <div class="stat-card">
          <div class="stat-iconAndInfo-container">
            <div class="stat-icon">
              <lightning-icon
                icon-name="utility:tour"
                size="small"
                class="km-icon"
              ></lightning-icon>
            </div>
            <div class="stat-info">
              <span class="stat-label">Total KM</span>
              <span class="stat-value">{kmAmount}km</span>
            </div>
          </div>

          <!-- <template if:false={isTimeSheetSubmittedOrApproved}>
            <button class="info-button" onclick={handleShowMileageInfo}>
              Info
            </button>
          </template> -->
        </div>

        <div class="stat-card">
          <!-- <div class="slds-grid_vertical">
            <div class="stat-iconAndInfo-container">
              <div class="stat-icon">
                <lightning-icon
                  icon-name="utility:summary"
                  size="small"
                  class="total-icon"
                ></lightning-icon>
              </div>
              <div class="stat-info">
                <span class="stat-label">Total Hours</span>
                <span class="stat-value">{totalHours}h</span>
              </div>
            </div> -->
          <div class="stat-iconAndInfo-container slds-var-m-top_small">
            <div class="stat-icon">
              <lightning-icon
                icon-name="utility:food_and_drink"
                size="small"
                class="total-icon"
              ></lightning-icon>
            </div>
            <div class="stat-info">
              <span class="stat-label">Total Break</span>
              <span class="stat-value">{totalBreakHours}h</span>
            </div>
          </div>
          <!-- </div> -->
        </div>
      </div>
    </div>

    <div class="timeSheetHeader">
      <div class="backAndFurtherDays-container">
        <button
          class="backButton"
          onclick={handleBackDays}
          disabled={isBackButtonDisabled}
        >
          <lightning-icon icon-name="utility:left"></lightning-icon>
        </button>
        <p class="date-text">{date}</p>
        <button
          class="furtherButton"
          onclick={handleFurtherDays}
          disabled={isFurtherButtonDisabled}
        >
          <lightning-icon icon-name="utility:right"></lightning-icon>
        </button>
      </div>

      <div class="settings-container">
        <button class="settings-button">
          <lightning-icon
            icon-name="utility:settings"
            onclick={handleOpenSettings}
          ></lightning-icon>
        </button>
      </div>
    </div>

    <!-- Calendar -->
    <template if:true={recordId}>
      <div class="fullcalendar"></div>
    </template>

    <template if:true={showNoEntriesModal}>
      <div class="warning-container">
        <div class="warning-icon">
          <lightning-icon
            icon-name="utility:warning"
            size="small"
            variant="warning"
          ></lightning-icon>
        </div>
        <p class="warning-text">{labels.Calendar_No_Entries}</p>
      </div>
    </template>
  </div>

  <!-- Static Footer -->
  <template if:false={isTimeSheetSubmittedOrApproved}>
    <div class="footer">
      <button
        onclick={handleSubmitTimeSheetMessage}
        class="submit-buttonSecond"
      >
        {labels.Calendar_Submit_For_Approval}
      </button>
    </div>
  </template>

  <!-- New TimeSheet or Absence Entry Modal -->
  <template if:true={showNewTimeSheetOrAbsenceModal}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Create_New_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="action-buttons">
          <button
            onclick={createTimeSheetEntry}
            class="action-button timesheet-button"
          >
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:clock"
                size="small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.Calendar_Add_Time_Sheet_Entry}</span
              >
              <span class="button-description"
                >{labels.Calendar_Add_Time_Sheet_Entry_Description}</span
              >
            </span>
          </button>

          <button
            onclick={createResourceAbsence}
            class="action-button break-button"
          >
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:pause"
                size="small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label">{labels.Calendar_Add_Break}</span>
              <span class="button-description"
                >{labels.Calendar_Add_Break_Description}</span
              >
            </span>
          </button>
        </div>

        <button class="cancel-button" onclick={handleCloseForm}>
          {labels.Calendar_Cancel}
        </button>
      </div>
    </div>
  </template>

  <!-- Mileage Info Modal -->
  <template if:true={showMileageInfoModal}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Mileage_Options}</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="action-buttons">
          <button onclick={handleInMileageEntries} class="action-button">
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:travel_and_places"
                size="small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.Calendar_In_Mileage_Entries}</span
              >
              <span class="button-description"
                >{labels.Calendar_In_Mileage_Entries_Description}</span
              >
            </span>
          </button>

          <button onclick={handleOutMileageEntries} class="action-button">
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:travel_and_places"
                size="small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.Calendar_Out_Mileage_Entries}</span
              >
              <span class="button-description"
                >{labels.Calendar_Out_Mileage_Entries_Description}</span
              >
            </span>
          </button>
        </div>

        <button class="cancel-button" onclick={handleCloseForm}>
          {labels.Calendar_Cancel}
        </button>
      </div>
    </div>
  </template>

  <!-- Mileage Entries Modal -->
  <template if:true={showMileageEntries}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Mileage_Entries}</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="MileageEntries-container">
          <template for:each={mileageEntries} for:item="entry">
            <div class="MileageEntryContainer" key={entry.Id}>
              <div class="form-element">
                <label class="slds-form-element__label"
                  >{labels.Calendar_Mileage_Type}</label
                >
                <div class="slds-form-element__control">
                  <input
                    type="text"
                    readonly
                    class="slds-input"
                    value={entry.Type__c}
                  />
                </div>
              </div>

              <div class="form-element">
                <label class="slds-form-element__label"
                  >{labels.Calendar_Mileage_Allowance}</label
                >
                <div class="slds-form-element__control">
                  <input
                    type="text"
                    readonly
                    class="slds-input"
                    value={entry.Allowance_Type__c}
                  />
                </div>
              </div>

              <div class="form-element">
                <label class="slds-form-element__label"
                  >{labels.Calendar_Mileage_Starting_Mileage}</label
                >
                <div class="slds-form-element__control">
                  <input
                    type="text"
                    readonly
                    class="slds-input"
                    value={entry.Starting_Mileage__c}
                  />
                </div>
              </div>

              <div class="form-element">
                <label class="slds-form-element__label"
                  >{labels.Calendar_Mileage_Ending_Mileage}</label
                >
                <div class="slds-form-element__control">
                  <input
                    type="text"
                    readonly
                    class="slds-input"
                    value={entry.Ending_Mileage__c}
                  />
                </div>
              </div>

              <div class="button-mileage-container">
                <button
                  class="cancel-button"
                  type="button"
                  onclick={handleCloseForm}
                >
                  {labels.Calendar_Cancel}
                </button>
                <!-- <template if:false={showNoEntriesModal}> -->
                <button
                  class="submit-button"
                  onclick={handleMileageEntryEdit}
                  data-id={entry.Id}
                >
                  {labels.Calendar_Edit}
                </button>
                <!-- </template> -->
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </template>

  <!-- Replace the In Mileage Message modal -->
  <template if:true={showInMileageMessage}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">
          {labels.Calendar_No_In_Mileage_Entries_Description}
        </h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="action-buttons">
          <button onclick={handleNewInMileageEntry} class="action-button">
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:travel_and_places"
                size="small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.Calendar_Add_In_Mileage_Entry}</span
              >
              <span class="button-description"
                >{labels.Calendar_Add_In_Mileage_Entry_Description}</span
              >
            </span>
          </button>
        </div>
        <button class="cancel-button" onclick={handleCloseForm}>
          {labels.Calendar_Cancel}
        </button>
      </div>
    </div>
  </template>

  <!-- Replace the Out Mileage Message modal -->
  <template if:true={showOutMileageMessage}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">
          {labels.Calendar_No_Out_Mileage_Entries_Description}
        </h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="action-buttons">
          <button onclick={handleNewOutMileageEntry} class="action-button">
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:travel_and_places"
                size="small"
              ></lightning-icon>
            </span>
            <span class="button-text">
              <span class="button-label"
                >{labels.Calendar_Add_Out_Mileage_Entry}</span
              >
              <span class="button-description"
                >{labels.Calendar_Add_Out_Mileage_Entry_Description}</span
              >
            </span>
          </button>
        </div>
        <button class="cancel-button" onclick={handleCloseForm}>
          {labels.Calendar_Cancel}
        </button>
      </div>
    </div>
  </template>

  <!-- Submit Time Sheet Message Modal -->
  <template if:true={submitTimeSheetMessage}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Submit_Time_Sheet}</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="warning-container">
          <div class="warning-icon">
            <lightning-icon
              icon-name="utility:warning"
              size="small"
              variant="warning"
            ></lightning-icon>
          </div>
          <p class="warning-text">{labels.Calendar_Warning_Submit_Timesheet}</p>
        </div>
        <div class="button-group">
          <button class="cancel-button" onclick={handleCloseForm}>
            {labels.Calendar_Cancel}
          </button>
          <button class="submit-button" onclick={handleSubmitTimeSheet}>
            {labels.Calendar_Submit}
          </button>
        </div>
      </div>
    </div>
  </template>

  <!--//////////////////////////////////////////////////////////////////////////////-->

  <!-- New Mileage Out Entry Form -->
  <template if:true={showOutMileageEntryNewForm}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_New_Out_Mileage_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="Mileage_Entry__c"
          onsuccess={handleSuccessMileageEntryNew}
        >
          <lightning-messages></lightning-messages>
          <div class="form-fields">
            <lightning-input-field
              field-name="Time_Sheet__c"
              value={recordId}
              class="slds-hide"
            ></lightning-input-field>
            <lightning-input-field
              field-name="Type__c"
              value="Ending"
              class="slds-hide"
            ></lightning-input-field>
            <lightning-input-field
              field-name="Service_Resource__c"
              value={resourceId}
              class="slds-hide"
            ></lightning-input-field>

            <lightning-input-field
              field-name="Allowance_Type__c"
              required
            ></lightning-input-field>
            <lightning-input-field
              field-name="Starting_Mileage__c"
              required
            ></lightning-input-field>
            <lightning-input-field
              field-name="Ending_Mileage__c"
              required
            ></lightning-input-field>
          </div>
          <div class="button-group">
            <button class="cancel-button" onclick={handleCloseForm}>
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <!-- New Mileage In Entry Form -->
  <template if:true={showInMileageEntryNewForm}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_New_In_Mileage_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="Mileage_Entry__c"
          onsuccess={handleSuccessMileageEntryNew}
        >
          <lightning-messages></lightning-messages>
          <div class="form-fields">
            <lightning-input-field
              field-name="Type__c"
              value="Starting"
              class="slds-hide"
            ></lightning-input-field>
            <lightning-input-field
              field-name="Time_Sheet__c"
              value={recordId}
              class="slds-hide"
            ></lightning-input-field>
            <lightning-input-field
              field-name="Service_Resource__c"
              value={resourceId}
              class="slds-hide"
            ></lightning-input-field>

            <lightning-input-field
              field-name="Allowance_Type__c"
              required
            ></lightning-input-field>
            <lightning-input-field
              field-name="Starting_Mileage__c"
              required
            ></lightning-input-field>
            <lightning-input-field
              field-name="Ending_Mileage__c"
              required
            ></lightning-input-field>
          </div>
          <div class="button-group">
            <button class="cancel-button" onclick={handleCloseForm}>
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <!-- New TimeSheetEntry Form -->
  <template if:true={showTimeSheetEntryNewForm}>
    <div
      class="mobile-backdrop"
      onclick={handleCloseNewTimeSheetOrAbsenceEntry}
    ></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_New_Time_Sheet_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <c-timesheet-entry-form
          start-date={startDate}
          end-date={endDate}
          time-sheet-id={recordId}
          service-resource-id={resourceId}
          start-date-and-hours={startDateAndHours}
          end-date-and-hours={endDateAndHours}
          ontimesheetcreated={handleSuccessTimeSheetOrAbsenceEntry}
          oncloseform={handleCloseForm}
        ></c-timesheet-entry-form>
      </div>
    </div>
  </template>

  <!-- Resource Absence New Form -->
  <template if:true={showResourceAbsenceNewForm}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_New_Break_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="ResourceAbsence"
          record-type-id={breakRecordTypeId}
          onsuccess={handleSuccessTimeSheetOrAbsenceEntry}
        >
          <lightning-messages></lightning-messages>

          <div class="form-fields">
            <lightning-input-field
              field-name="ResourceId"
              value={resourceId}
              class="slds-hide"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Start"
              value={startDateAndHours}
              required
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="End"
              value={endDateAndHours}
              required
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Type"
              required
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Description"
              class="form-element"
            >
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button class="cancel-button" onclick={handleCloseForm}>
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <!-- TimeSheet Entry Edit Form -->
  <template if:true={showTimeSheetEntryEditForm}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Edit_Time_Sheet_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="TimeSheetEntry"
          onsuccess={handleSuccessTimeSheetOrAbsenceEntry}
          record-id={recordIdBeingHandled}
        >
          <lightning-messages></lightning-messages>

          <div class="form-fields">
            <lightning-input-field field-name="StartTime" class="form-element">
            </lightning-input-field>

            <lightning-input-field field-name="EndTime" class="form-element">
            </lightning-input-field>

            <lightning-input-field
              field-name="Type"
              class="form-element"
              required
            >
            </lightning-input-field>

            <lightning-input-field field-name="Subject" class="form-element">
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button class="cancel-button" onclick={handleCloseForm}>
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <!-- Resource Absence Edit Form -->
  <template if:true={showResourceAbsenceEditForm}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Edit_Break_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="ResourceAbsence"
          onsuccess={handleSuccessTimeSheetOrAbsenceEntry}
          record-id={recordIdBeingHandled}
        >
          <lightning-messages></lightning-messages>

          <div class="form-fields">
            <lightning-input-field field-name="Start" class="form-element">
            </lightning-input-field>

            <lightning-input-field field-name="End" class="form-element">
            </lightning-input-field>

            <lightning-input-field field-name="Type" class="form-element">
            </lightning-input-field>

            <lightning-input-field
              field-name="Description"
              class="form-element"
            >
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button class="cancel-button" onclick={handleCloseForm}>
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <!-- Mileage Entry Edit Form -->
  <template if:true={showMileageEntryEditForm}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_Edit_Mileage_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="Mileage_Entry__c"
          onsuccess={handleSuccessMileageEntryEdit}
          record-id={mileageEntryIdBeingHandled}
        >
          <lightning-messages></lightning-messages>

          <div class="form-fields">
            <lightning-input-field
              field-name="Starting_Mileage__c"
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Ending_Mileage__c"
              class="form-element"
            >
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button
              class="cancel-button"
              type="button"
              onclick={handleCloseForm}
            >
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <!--//////////////////////////////////////////////////////////////////////////////-->

  <!-- Settings Modal -->
  <template if:true={settingsEditModal}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_User_Settings}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-card
          title={labels.Calendar_User_Settings_Time_Range}
          icon-name="utility:clock"
        >
          <div class="slider-container">
            <!-- Min Time Slider -->
            <div class="min-slider">
              <lightning-slider
                label={labels.Calendar_User_Settings_Start_Time}
                min="0"
                max="24"
                step="1"
                value={minValue}
                onchange={handleMinChange}
              >
              </lightning-slider>
              <p>{labels.Calendar_User_Settings_Start_Time}: {minLabel}</p>
            </div>
            <!-- Max Time Slider -->
            <div class="max-slider">
              <lightning-slider
                label={labels.Calendar_User_Settings_End_Time}
                min="0"
                max="24"
                step="1"
                value={maxValue}
                onchange={handleMaxChange}
              >
              </lightning-slider>
              <p>{labels.Calendar_User_Settings_End_Time}: {maxLabel}</p>
            </div>
          </div>
        </lightning-card>

        <div class="button-group">
          <button class="cancel-button" onclick={handleCloseForm}>
            {labels.Calendar_Cancel}
          </button>
          <button
            class="submit-button"
            onclick={handleSuccessSettings}
            data-type="edit"
          >
            {labels.Calendar_Save}
          </button>
        </div>
      </div>
    </div>
  </template>

  <template if:true={settingsNewModal}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_User_Settings}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-card
          title={labels.Calendar_User_Settings_Time_Range}
          icon-name="utility:clock"
        >
          <div class="slider-container">
            <!-- Min Time Slider -->
            <div class="min-slider">
              <lightning-slider
                label={labels.Calendar_User_Settings_Start_Time}
                min="0"
                max="24"
                step="0.5"
                value={minValue}
                onchange={handleMinChange}
              >
              </lightning-slider>
              <p>{labels.Calendar_User_Settings_Start_Time}: {minLabel}</p>
            </div>
            <!-- Max Time Slider -->
            <div class="max-slider">
              <lightning-slider
                label={labels.Calendar_User_Settings_End_Time}
                min="0"
                max="24"
                step="0.5"
                value={maxValue}
                onchange={handleMaxChange}
              >
              </lightning-slider>
              <p>{labels.Calendar_User_Settings_End_Time}: {maxLabel}</p>
            </div>
          </div>
        </lightning-card>

        <div class="button-group">
          <button class="cancel-button" onclick={handleCloseForm}>
            {labels.Calendar_Cancel}
          </button>
          <button
            class="submit-button"
            onclick={handleSuccessSettings}
            data-type="new"
          >
            {labels.Calendar_Save}
          </button>
        </div>
      </div>
    </div>
  </template>

  <!--///////////////////////////////// ADD LABELS /////////////////////////////////////////////-->
  <template if:true={showBreakMissingModal}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">Break missing</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="warning-container">
          <div class="warning-icon">
            <lightning-icon
              icon-name="utility:warning"
              size="small"
              variant="warning"
            ></lightning-icon>
          </div>
          <p class="warning-text">
            It looks like you have forgotten to add your break. Please add it
            now before submitting your time sheet or correct your time sheet.
          </p>
        </div>
        <div class="action-buttons">
          <template if:false={hasEnteredBreak}>
            <button onclick={handleNewBreak} class="action-button">
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:pause"
                  size="small"
                ></lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">Add a break</span>
                <span class="button-description"
                  >Add to your time sheet a break</span
                >
              </span>
            </button>
          </template>
        </div>
        <button class="cancel-button" onclick={handleCloseForm}>
          {labels.Calendar_Cancel}
        </button>
      </div>
    </div>
  </template>

  <template if:true={showNewBreakEntryModal}>
    <div class="mobile-backdrop" onclick={handleCloseForm}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.Calendar_New_Break_Entry}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          object-api-name="ResourceAbsence"
          record-type-id={breakRecordTypeId}
          onsuccess={handleSuccessNewBreakEntry}
        >
          <lightning-messages></lightning-messages>

          <div class="form-fields">
            <lightning-input-field
              field-name="ResourceId"
              value={resourceId}
              class="slds-hide"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Start"
              value={startDate}
              required
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="End"
              value={endDate}
              required
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Type"
              required
              class="form-element"
            >
            </lightning-input-field>

            <lightning-input-field
              field-name="Description"
              class="form-element"
            >
            </lightning-input-field>
          </div>

          <div class="button-group">
            <button class="cancel-button" onclick={handleCloseForm}>
              {labels.Calendar_Cancel}
            </button>
            <button class="submit-button" type="submit">
              {labels.Calendar_Save}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>
</template>