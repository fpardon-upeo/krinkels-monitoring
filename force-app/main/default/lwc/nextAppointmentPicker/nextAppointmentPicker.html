<!--
 - Created by fpardon on 15/11/2024.
 -->

<!-- Next Appointment Picker -->
<template>
  <template if:true={showSpinner}>
    <c-loading-spinner
      loading-message={labels.AppointmentPicker_Loading_Message}
    ></c-loading-spinner>
  </template>

  <template if:true={showHasIncompleteWorkSteps}>
    <div class="warning-container">
      <div class="warning-box">
        <lightning-icon
          icon-name="utility:warning"
          size="small"
          alternative-text="Warning"
          class="slds-m-right_small"
        ></lightning-icon>
        <span class="warning-text"
          >{labels.AppointmentPicker_Incomplete_Work_Steps_Message}</span
        >
      </div>
    </div>
  </template>

  <template if:true={showInitialScreen}>
    <lightning-card>
      <div class="slds-grid slds-grid_vertical slds-p-around_small">
        <div
          class="slds-text-heading_medium slds-align_absolute-center slds-p-horizontal_medium slds-p-bottom_medium"
        >
          {labels.AppointmentPicker_Next_Action_Text}
        </div>

        <div
          class="slds-grid slds-grid_align-center slds-wrap slds-gutters_medium"
        >
          <div
            class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
          >
            <button
              class="action-button brand"
              ontouchstart={handleTouchStart}
              ontouchend={handleTouchEnd}
              onclick={handleSetAppointmentClicked}
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:tour"
                  size="medium"
                  class="slds-m-bottom_small"
                >
                </lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">
                  {labels.AppointmentPicker_Select_Next_Appointment_Button}
                </span>
                <span class="button-description">
                  {labels.AppointmentPicker_Next_Action_Sub_Text}
                </span>
              </span>
            </button>
          </div>
          <div
            class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
          >
            <button
              class="action-button brand"
              ontouchstart={handleTouchStart}
              ontouchend={handleTouchEnd}
              onclick={handleSimplyClose}
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:check"
                  size="medium"
                  class="slds-m-bottom_small"
                >
                </lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">
                  {labels.AppointmentPicker_Simple_Checkout_Button_Text}
                </span>
                <span class="button-description">
                  {labels.AppointmentPicker_Simple_Checkout_Button_Sub_Text}
                </span>
              </span>
            </button>
          </div>
          <div
            class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
          >
            <button
              class="action-button brand"
              ontouchstart={handleTouchStart}
              ontouchend={handleTouchEnd}
              onclick={handleTakeBreakClicked}
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:food_and_drink"
                  size="medium"
                  class="slds-m-bottom_small"
                >
                </lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">
                  {labels.AppointmentPicker_Break_Button_text}
                </span>
                <span class="button-description">
                  {labels.AppointmentPicker_Break_Button_Sub_Text}
                </span>
              </span>
            </button>
          </div>
          <div
            class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
          >
            <button
              class="action-button brand"
              ontouchstart={handleTouchStart}
              ontouchend={handleTouchEnd}
              onclick={handleInternalOrderClicked}
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:case"
                  size="medium"
                  class="slds-m-bottom_small"
                >
                </lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">
                  {labels.StartDay_Internal_Button_Text}
                </span>
                <span class="button-description">
                  {labels.StartDay_Internal_Button_Sub_Text}
                </span>
              </span>
            </button>
          </div>
          <div
            class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
          >
            <button
              class="action-button brand"
              ontouchstart={handleTouchStart}
              ontouchend={handleTouchEnd}
              onclick={handleEndDayClicked}
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:waits"
                  size="medium"
                  class="slds-m-bottom_small"
                >
                </lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">
                  {labels.AppointmentPicker_End_Day_Button}
                </span>
                <span class="button-description">
                  {labels.AppointmentPicker_End_Day_Button_Sub_Text}
                </span>
              </span>
            </button>
          </div>
          <div
                  class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
          >
            <button
                    class="action-button brand"
                    ontouchstart={handleTouchStart}
                    ontouchend={handleTouchEnd}
                    onclick={handleEndDayWithDepotClicked}
            >
              <span class="button-icon">
                <lightning-icon
                        icon-name="utility:waits"
                        size="medium"
                        class="slds-m-bottom_small"
                >
                </lightning-icon>
              </span>
              <span class="button-text">
                <span class="button-label">
                  {labels.AppointmentPicker_Last_Depot_Text}
                </span>
                <span class="button-description">
                  {labels.AppointmentPicker_Last_Depot_Sub_Text}
                </span>
              </span>
            </button>
          </div>
        </div>
      </div>
    </lightning-card>
  </template>

  <template if:true={showWorkOrderScreen}>
    <div class="mobile-backdrop" onclick={handleClose}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">Internal Work Order</h2>
      </div>
      <div class="bottom-sheet-content">
        <c-internal-work-order-form
          service-resource-id={serviceResourceId}
          record-id={serviceResourceId}
          oncloseform={handleWorkOrderCreated}
        >
        </c-internal-work-order-form>

        <div class="button-notGroup">
          <button class="cancel-button" onclick={handleClose}>
            {labels.AppointmentPicker_Cancel_Button}
          </button>
        </div>
      </div>
    </div>
  </template>

  <template if:true={showAppointmentScreen}>
    <div class="mobile-backdrop" onclick={handleClose}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">Select Appointment</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="table-container">
          <c-send-notification-action onbubble={handleBubbleNotification}></c-send-notification-action>
          <div class="datatable-wrapper">
            <lightning-datatable
              class="slds-table_striped slds-cell-wrap"
              columns={columns}
              data={serviceAppointments}
              key-field="Id"
              max-row-selection="1"
              wrap-text-max-lines="3"
              onrowselection={handleRowSelection}
            ></lightning-datatable>
          </div>
        </div>
        <div class="button-group">
          <button class="cancel-button" onclick={handleClose}>
            {labels.AppointmentPicker_Cancel_Button}
          </button>
          <button
            class="submit-button"
            onclick={handleSelect}
            disabled={disableNextButton}
          >
            {labels.AppointmentPicker_Next_Button}
          </button>
        </div>
      </div>
    </div>
  </template>

  <template if:true={showBreakForm}>
    <div class="mobile-backdrop" onclick={handleClose}></div>
    <div class="mobile-bottom-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.AppointmentPicker_Break_Form_Title}</h2>
      </div>
      <div class="bottom-sheet-content">
        <div class="break-form">
          <lightning-combobox
            name="breakDuration"
            label={labels.AppointmentPicker_Break_Duration_Label}
            value={breakDuration}
            options={breakDurationOptions}
            onchange={handleBreakDurationChange}
            required
          >
          </lightning-combobox>

          <div class="button-group">
            <button class="cancel-button" onclick={handleClose}>
              {labels.AppointmentPicker_Cancel_Button}
            </button>
            <button class="submit-button" onclick={handleSaveBreak}>
              {labels.AppointmentPicker_Save_Button}
            </button>
          </div>
        </div>
      </div>
    </div>
  </template>

  <template if:true={showMilageEntryScreen}>
    <div class="mobile-backdrop" onclick={handleClose}></div>
    <div class="mobile-bottom-sheet large-sheet">
      <div class="bottom-sheet-header">
        <div class="drag-indicator"></div>
        <h2 class="sheet-title">{labels.StartDay_KM_Card_Title}</h2>
      </div>
      <div class="bottom-sheet-content">
        <lightning-record-edit-form
          onsuccess={handleMileageSuccess}
          object-api-name="Mileage_Entry__c"
        >
          <div class="slds-grid slds-grid_vertical slds-p-around_small">
            <div class="slds-col">
              <lightning-input-field
                field-name="Allowance_Type__c"
              ></lightning-input-field>
              <lightning-input-field
                field-name="Type__c"
                value={mileageType}
              ></lightning-input-field>
              <lightning-input-field
                class="slds-hide"
                field-name="Service_Resource__c"
                value={serviceResourceId}
              ></lightning-input-field>
              <lightning-input-field
                field-name="Starting_Location_Type__c"
                value={startingLocationType}
              ></lightning-input-field>
              <lightning-input-field
                field-name="Ending_Location_Type__c"
                value={endingLocationType}
              ></lightning-input-field>
              <lightning-input-field
                field-name="Starting_Mileage__c"
              ></lightning-input-field>
              <lightning-input-field
                class="slds-hide"
                field-name="Work_Order__c"
                value={workOrderId}
              ></lightning-input-field>
              <lightning-input-field
                class="slds-hide"
                field-name="Time_Sheet__c"
                value={timeSheetId}
              ></lightning-input-field>
            </div>
          </div>
          <div class="button-group">
            <button class="cancel-button" onclick={handleClose}>
              {labels.AppointmentPicker_Cancel_Button}
            </button>
            <button class="submit-button" type="submit">
              {labels.StartDay_KM_Save_Button_Text}
            </button>
          </div>
        </lightning-record-edit-form>
      </div>
    </div>
  </template>

  <c-toast-message
    if:true={shouldShowToast}
    message={toastMessage}
    type={toastType}
    onclose={hideToast}
  ></c-toast-message>
</template>