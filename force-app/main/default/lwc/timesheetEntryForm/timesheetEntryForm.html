<template>
  <template if:true={showAppointmentScreen}>
    <div class="table-container">
      <div class="datatable-wrapper">
        <lightning-datatable
          class="slds-table_striped slds-cell-wrap"
          columns={columns}
          data={serviceAppointments}
          key-field="Id"
          max-row-selection="1"
          wrap-text-max-lines="3"
          onrowselection={handleRowSelection}
        >
        </lightning-datatable>
      </div>
    </div>
  </template>

  <div if:true={showBottomFooter} class="footer">
    <div class="button-group">
      <button class="cancel-button" onclick={handleBack}>Back</button>
      <button
        if:true={showAppointmentScreen}
        class="grey-button"
        onclick={handleSelect}
        disabled={disableNextButton}
      >
        Continue
      </button>
    </div>
  </div>

  <template if:true={showRecordForm}>
    <lightning-record-edit-form
      onsuccess={handleTimesheetCreated}
      record-id={timesheetEntryId}
      object-api-name="TimeSheetEntry"
    >
      <div class="slds-grid slds-grid_vertical slds-p-around_small">
        <div class="slds-col">
          <!-- Moved this to the top of the form because when click it deletes everything from the form so it's better to have it as 1st element rather than in last and have to re-enter all the data -->
          <div
            class="slds-form-element slds-m-top_medium slds-m-bottom_x-small"
          >
            <label class="slds-form-element__label">
              <abbr class="slds-required" title="required">*</abbr>
              Work Order
            </label>
            <div class="slds-form-element__control">
              <div
                class="slds-grid slds-gutters slds-grid_vertical-align-center"
              >
                <div class="slds-col slds-size_2-of-4">
                  <button
                    type="button"
                    class="slds-button slds-button_brand lookup-button"
                    onclick={handleSetAppointmentClicked}
                  >
                    <lightning-icon
                      icon-name="utility:search"
                      size="xx-small"
                      variant="inverse"
                      class="slds-m-right_xx-small"
                    >
                    </lightning-icon>
                    Select Work Order
                  </button>
                </div>
                <div class="slds-col slds-size_2-of-4">
                  <lightning-input-field
                    if:true={workOrderId}
                    field-name="WorkOrderId"
                    value={workOrderId}
                    variant="label-hidden"
                    required
                  >
                  </lightning-input-field>
                </div>
              </div>
            </div>
          </div>

          <lightning-input-field
            field-name="TimeSheetId"
            value={timeSheetId}
            class="slds-hide"
          >
          </lightning-input-field>

          <lightning-input-field
            field-name="StartTime"
            value={startDateAndHours}
            onchange={handleStartTimeChange}
            required
            class="form-element"
          >
          </lightning-input-field>

          <lightning-input-field
            field-name="EndTime"
            value={endDateAndHours}
            onchange={handleEndTimeChange}
            required
            class="form-element"
          >
          </lightning-input-field>

          <lightning-input-field
            field-name="Type"
            required
            class="form-element"
          >
          </lightning-input-field>

          <lightning-input-field field-name="Subject" class="form-element">
          </lightning-input-field>
        </div>
      </div>
      <div class="button-group">
        <button class="cancel-button" onclick={handleCancel}>Cancel</button>
        <button class="submit-button" type="submit">Save</button>
      </div>
    </lightning-record-edit-form>
  </template>
</template>