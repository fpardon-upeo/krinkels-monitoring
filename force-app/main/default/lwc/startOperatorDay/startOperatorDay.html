<template>
  <div class="page-wrapper">
    <c-start-operator-day-metrics
      oncompletedappointments={handleShowStartOrNot}
      onrefreshall={handleRefreshAll}
      onfirstworkorderchecked={handleFirstWorkOrderChecked}
    ></c-start-operator-day-metrics>

    <!-- <div class="currentWork">
      <p>Current Work Order</p>
      <template if:true={showMultipleWorkOrders}>
        <p>
          Warning: you have multiple work orders in progress, please fix this.
        </p>
      </template>
    </div> -->

    <div if:true={showTimesheetScreen} class="top-nav">
      <div class="nav-content">
        <lightning-button
          label="Back to Main Menu"
          icon-name="utility:home"
          variant="brand"
          onclick={handleBack}
        >
        </lightning-button>
      </div>
    </div>

    <div class="content-area">
      <template if:true={showSpinner}>
        <c-loading-spinner
          loading-message={labels.StartDay_Loading_Message}
        ></c-loading-spinner>
      </template>

      <template if:true={showInitialScreen}>
        <lightning-card class="initial-screen">
          <div class="slds-grid slds-grid_vertical slds-p-around_small">
            <div
              class="slds-text-heading_medium slds-align_absolute-center slds-p-horizontal_medium slds-p-bottom_medium"
            >
              {labels.StartDay_Next_Action_Text}
            </div>
            <div
              class="slds-grid slds-grid_vertical slds-grid_align-center slds-wrap slds-gutters_medium"
            >
              <div
                class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
              >
                <button
                  if:true={showStartDayButton}
                  class="action-button brand"
                  ontouchstart={handleTouchStart}
                  ontouchend={handleTouchEnd}
                  onclick={handleSetAppointmentClicked}
                >
                  <span class="button-icon">
                    <lightning-icon
                      icon-name="utility:setup_assistant_guide"
                      size="medium"
                      class="slds-m-bottom_small"
                    >
                    </lightning-icon>
                  </span>
                  <span class="button-text">
                    <span class="button-label">
                      {labels.StartDay_Start_Button_Text}
                    </span>
                    <span class="button-description">
                      {labels.StartDay_Start_Button_Sub_Text}
                    </span>
                  </span>
                </button>
              </div>
              <div
                class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
              >
                <button
                  class="action-button brand"
                  ontouchstart={handleTouchStart}
                  ontouchend={handleTouchEnd}
                  onclick={handleSetAppointmentClickedNoKM}
                >
                  <span class="button-icon">
                    <lightning-icon
                      icon-name="utility:event"
                      size="medium"
                      class="slds-m-bottom_small"
                    >
                    </lightning-icon>
                  </span>
                  <span class="button-text">
                    <span class="button-label">
                      {labels.StartDay_Next_Appointment_Button_Text}
                    </span>
                    <span class="button-description">
                      {labels.StartDay_Next_Appointment_Button_Sub_Text}
                    </span>
                  </span>
                </button>
              </div>
              <div
                class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
              >
                <button
                  class="action-button brand"
                  ontouchstart={handleTouchStart}
                  ontouchend={handleTouchEnd}
                  onclick={handleOpenWasteVisitScreen}
                >
                  <span class="button-icon">
                    <lightning-icon
                      icon-name="utility:case"
                      size="medium"
                      class="slds-m-bottom_small"
                    >
                    </lightning-icon>
                  </span>
                  <span class="button-text">
                    <span class="button-label">
                      {labels.StartDay_Internal_Button_Text}
                    </span>
                    <span class="button-description">
                      {labels.StartDay_Internal_Button_Sub_Text}
                    </span>
                  </span>
                </button>
              </div>
              <div
                class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
              >
                <button
                  class="action-button brand"
                  ontouchstart={handleTouchStart}
                  ontouchend={handleTouchEnd}
                  onclick={handleOpenEndDay}
                >
                  <span class="button-icon">
                    <lightning-icon
                      icon-name="utility:end_call"
                      size="medium"
                      class="slds-m-bottom_small"
                    >
                    </lightning-icon>
                  </span>
                  <span class="button-text">
                    <span class="button-label">
                      {labels.StartDay_End_Button_Text}
                    </span>
                    <span class="button-description">
                      {labels.StartDay_End_Button_Sub_Text}
                    </span>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </lightning-card>
      </template>

      <!-- Add End Day Screen -->
      <template if:true={showEndDayScreen}>
        <lightning-card>
          <div class="slds-grid slds-grid_vertical slds-p-around_small">
            <div
              class="slds-text-heading_medium slds-align_absolute-center slds-p-horizontal_medium slds-p-bottom_medium"
            >
              End Day Actions
            </div>
            <div
              class="slds-grid slds-grid_vertical slds-grid_align-center slds-wrap slds-gutters_medium"
            >
              <div
                class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
              >
                <button
                  class="action-button brand"
                  ontouchstart={handleTouchStart}
                  ontouchend={handleTouchEnd}
                  onclick={handleEndDayClicked}
                >
                  <span class="button-icon">
                    <lightning-icon
                      icon-name="utility:location"
                      size="medium"
                      class="slds-m-bottom_small"
                    >
                    </lightning-icon>
                  </span>
                  <span class="button-text">
                    <span class="button-label">
                      {labels.StartDay_End_Day_Button_Text}
                    </span>
                    <span class="button-description">
                      {labels.StartDay_End_Day_Button_Sub_Text}
                    </span>
                  </span>
                </button>
              </div>
              <div
                class="slds-col slds-size_1-of-1 slds-p-bottom_medium action-buttons"
              >
                <button
                  class="action-button brand"
                  ontouchstart={handleTouchStart}
                  ontouchend={handleTouchEnd}
                  onclick={handleTimeSheetClicked}
                >
                  <span class="button-icon">
                    <lightning-icon
                      icon-name="utility:clock"
                      size="medium"
                      class="slds-m-bottom_small"
                    >
                    </lightning-icon>
                  </span>
                  <span class="button-text">
                    <span class="button-label">
                      {labels.StartDay_Timesheet_Button_Text}
                    </span>
                    <span class="button-description">
                      {labels.StartDay_Timesheet_Button_Sub_Text}
                    </span>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </lightning-card>
      </template>

      <template if:true={showMilageEntryScreen}>
        <c-show-mileage-screen
          record-id={timeSheetId}
          onback={handleBack}
        ></c-show-mileage-screen>
      </template>

      <template if:true={showWorkOrderScreen}>
        <c-internal-work-order-form
          service-resource-id={serviceResourceId}
          record-id={serviceResourceId}
          oncloseform={handleBack}
        ></c-internal-work-order-form>
      </template>

      <template if:true={showMilageEntryScreenSimple}>
        <lightning-card
          title={labels.StartDay_KM_Card_Title}
          icon-name="utility:transport_heavy_truck"
        >
          <lightning-record-edit-form
            onsuccess={handleMileageSuccess}
            object-api-name="Mileage_Entry__c"
          >
            <div class="slds-grid slds-grid_vertical slds-p-around_small">
              <div class="slds-col">
                <lightning-input-field
                  field-name="Allowance_Type__c"
                ></lightning-input-field>
                <lightning-input-field
                  class="slds-hide"
                  field-name="Service_Resource__c"
                  value={serviceResourceId}
                ></lightning-input-field>
                <lightning-input-field
                  class="slds-hide"
                  field-name="Type__c"
                  value="Starting"
                ></lightning-input-field>
                <lightning-input-field
                  field-name="Starting_Location_Type__c"
                  value="Home"
                ></lightning-input-field>
                <lightning-input-field
                  field-name="Ending_Location_Type__c"
                ></lightning-input-field>
                <lightning-input-field
                  field-name="Starting_Mileage__c"
                ></lightning-input-field>
                <lightning-input-field
                  class="slds-hide"
                  field-name="Work_Order__c"
                  value={nextWorkOrderId}
                ></lightning-input-field>
                <lightning-input-field
                  class="slds-hide"
                  field-name="Time_Sheet__c"
                  value={timeSheetId}
                ></lightning-input-field>
              </div>
            </div>
            <div class="slds-p-around_small slds-align_absolute-center">
              <lightning-button
                class="slds-m-top_small"
                type="submit"
                label={labels.StartDay_KM_Save_Button_Text}
              >
              </lightning-button>
            </div>
          </lightning-record-edit-form>
        </lightning-card>
      </template>

      <template if:true={showNavigationScreen}>
        <div>
          <a href={navigationUrl}>
            <div
              class="action-box neutral"
              ontouchstart={handleTouchStart}
              ontouchend={handleTouchEnd}
              onclick={handleHideNavigationScreen}
            >
              <lightning-icon
                icon-name="utility:event"
                size="medium"
                class="icon-green slds-m-bottom_small"
              >
              </lightning-icon>
              <div class="slds-text-heading_medium slds-p-bottom_small">
                {labels.StartDay_Open_Next_Appointment_Button_Text}
              </div>
            </div>
          </a>
        </div>
      </template>

      <template if:true={showAppointmentScreen}>
        <div class="table-container">
          <div class="slds-m-top_small slds-m-bottom_small">
            <c-send-notification-action onbubble={handleBubbleNotification}></c-send-notification-action>
          </div>
          <div class="datatable-wrapper">
            <lightning-datatable
              class="slds-table_striped slds-cell-wrap"
              columns={columns}
              data={serviceAppointments}
              key-field="Id"
              max-row-selection="1"
              wrap-text-max-lines="3"
              onrowselection={handleRowSelection}
              selected-rows={selectedRows}
              enable-infinite-loading
              suppress-bottom-bar
            >
            </lightning-datatable>
          </div>
        </div>
      </template>

      <template if:true={showTimesheetScreen}>
        <c-time-sheet-calendar
          record-id={timeSheetId}
          resource-id={serviceResourceId}
        ></c-time-sheet-calendar>
      </template>
    </div>

    <!-- Footer -->
    <div if:true={showBottomFooter} class="footer">
      <div class="footer-content">
        <div class="footer-buttons">
          <button onclick={handleBack} class="submit-button">
            <span class="button-icon">
              <lightning-icon
                icon-name="utility:home"
                size="small"
                variant="inverse"
              ></lightning-icon>
            </span>
            <span class="button-text">Back to Main Menu</span>
          </button>
          <template if:true={showAppointmentScreen}>
            <button
              if:true={disableNextButton}
              disabled
              class="next-button-disabled slds-m-left_medium"
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:forward"
                  size="small"
                  variant="inverse"
                ></lightning-icon>
              </span>
              <span class="button-text">Next</span>
            </button>
            <button
              if:false={disableNextButton}
              onclick={handleSelect}
              class="next-button slds-m-left_medium"
            >
              <span class="button-icon">
                <lightning-icon
                  icon-name="utility:forward"
                  size="small"
                  variant="inverse"
                ></lightning-icon>
              </span>
              <span class="button-text">Next</span>
            </button>
          </template>
          <!--
            <lightning-button
              if:true={showAppointmentScreen}
              label="Continue"
              icon-name="utility:forward"
              variant="neutral"
              disabled={disableNextButton}
              onclick={handleSelect}
            >
            </lightning-button>
            -->
        </div>
      </div>
    </div>
  </div>

  <c-toast-message
    if:true={shouldShowToast}
    message={toastMessage}
    type={toastType}
    onclose={hideToast}
  >
  </c-toast-message>
</template>